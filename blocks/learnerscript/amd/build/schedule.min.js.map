{"version":3,"file":"schedule.min.js","sources":["../src/schedule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Schedule a timings on a calender.\n *\n * @module     block_learnerscript/schedule\n * @copyright  2023 Moodle India Information Solutions Private Limited\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n    'core/ajax',\n    'block_learnerscript/ajax',\n    'core/event',\n    'block_learnerscript/select2/select2',\n    'block_learnerscript/report',\n    'core/str',\n    'core/templates'\n], function($, Ajax, ajax, Event, select2, report, Str, Templates) {\n\n    var schedule = {\n        /**\n         * To display scheduled timings for report\n         */\n        /**\n         * Schedule report form in popup in dashboard\n         * @param  {object} args reportid\n         * @return Popup with schedule form\n         */\n        schreportform: function(args) {\n            var promise = Ajax.call([{\n                methodname: 'block_learnerscript_schreportform',\n                args: {\n                    reportid: args.reportid,\n                    instance: args.instanceid\n                },\n            }]);\n            promise[0].done(function(response) {\n                response = $.parseJSON(response);\n                $('body').append(\"<div class='schreportform\" + args.instanceid + \"'>\" + response + \"</div>\");\n                var title_img = \"<img class='dialog_title_icon' alt='Scheduled Report' src='\" +\n                    M.util.image_url(\"schedule_icon\", \"block_learnerscript\") + \"'/>\";\n                Str.get_strings([{\n                    key: 'add_scheduled_report',\n                    component:'block_learnerscript'\n                },{\n                    key: 'close',\n                    component:'block_learnerscript'\n                },{\n                    key: 'schedule_report',\n                    component:'block_learnerscript'\n                }]).then(function(s){\n                    var dlg = $(\".schreportform\" + args.instanceid).dialog({\n                        resizable: true,\n                        autoOpen: false,\n                        width: \"90%\",\n                        title:s[0],\n                        modal: true,\n                        appendTo: \"#inst\" + args.instanceid,\n                        position: {\n                            my: \"center\",\n                            at: \"center\",\n                            of: \"#reportcontainer\" + args.instanceid\n                        },\n                        open: function() {\n                            $(this).closest(\".ui-dialog\").find(\".ui-dialog-titlebar-close\")\n                                .removeClass(\"ui-dialog-titlebar-close\")\n                                .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                                var Closebutton = $('.ui-icon-closethick').parent();\n                                $(Closebutton).attr({\n                                    \"title\" : s[1]\n                                });\n                            $(this).closest(\".ui-dialog\").find('.ui-dialog-title')\n                                .html(title_img + 'Schedule report');\n                        },\n                        close: function() {\n                            $(this).dialog('destroy').remove();\n                        }\n                    });\n                    var dlg = $(\".schreportform\" + args.instanceid).dialog({\n                        resizable: true,\n                        autoOpen: false,\n                        width: \"90%\",\n                        title: s[0],\n                        modal: true,\n                        appendTo: \"#inst\" + args.instanceid,\n                        position: {\n                            my: \"center\",\n                            at: \"center\",\n                            of: \"#reportcontainer\" + args.instanceid\n                        },\n                        open: function() {\n                            $(this).closest(\".ui-dialog\").find(\".ui-dialog-titlebar-close\")\n                                .removeClass(\"ui-dialog-titlebar-close\")\n                                .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                                var Closebutton = $('.ui-icon-closethick').parent();\n                                $(Closebutton).attr({\n                                    \"title\" : s[1]\n                                });\n                            $(this).closest(\".ui-dialog\").find('.ui-dialog-title')\n                                .html(title_img + s[2]);\n                        },\n                        close: function() {\n                            $(this).dialog('destroy').remove();\n                        }\n                    });\n                    dlg.dialog(\"open\");\n                });\n\n                $(\"#id_role\" + args.instanceid).select2();\n                this.SelectRoleUsers();\n                this.schformvalidation({\n                    reportid: args.reportid,\n                    form: 'schform' + args.instanceid,\n                    reqclass: 'schformreq' + args.instanceid,\n                    instanceid: args.instanceid\n                });\n            }).fail(function() {\n            });\n        },\n        ScheduledTimings: function(args) {\n            $(\"select[data-select2='1']\").select2({\n                theme: \"classic\"\n            });\n            this.SelectRoleUsers();\n            Str.get_strings([{\n                key: 'filter_all',\n                component: 'block_learnerscript'\n            }]).then(function(s){\n                $('#scheduledtimings').dataTable({\n                    \"processing\": true,\n                    \"serverSide\": true,\n                    \"lengthMenu\": [\n                        [5, 10, 25, 50, -1],\n                        [5, 10, 25, 50, s[0]]\n                    ],\n                    \"idisplaylength\": 5,\n                    'ordering': false,\n                    \"ajax\": {\n                        \"method\": \"GET\",\n                        \"url\": M.cfg.wwwroot + \"/blocks/learnerscript/components/scheduler/ajax.php\",\n                        \"data\": args\n                    }\n                });\n            });\n\n            /**\n             * Add schedule form role for widget\n             */\n            $(document).on('change', \".schuserroleslist\", function() {\n                var reportid = $(this).data('reportid');\n                var reportinstance = $(this).data('reportinstance');\n                schedule.rolewiseusers({reportid: reportid, reportinstance: reportinstance});\n            });\n\n            /**\n             * Add schedule form users for widget\n             */\n\n            $(document).on('change', \".schusers_data\", function() {\n                var reportid = $(this).data('reportid');\n                var reportinstance = $(this).data('reportinstance');\n                schedule.addschusers({reportid: reportid, reportinstance: reportinstance});\n            });\n\n            $(document).on('change', \"select[name='frequency']\", function() {\n                var reportid = $(this).data('reportid');\n                var reportinstance = $(this).data('reportinstance');\n                schedule.frequency_schedule({reportid: reportid, reportinstance: reportinstance});\n            });\n\n        },\n        ViewSchUsersTable: function(args) {\n            Str.get_strings([{\n                key: 'filter_all',\n                component: 'block_learnerscript'\n            }]).then(function(s){\n                $('#scheduledusers').dataTable({\n                    \"processing\": true,\n                    \"serverSide\": true,\n                    \"lengthMenu\": [\n                        [5, 10, 25, 50, -1],\n                        [5, 10, 25, 50, s[0]]\n                    ],\n                    \"idisplaylength\": 5,\n                    'ordering': false,\n                    \"ajax\": {\n                        \"method\": \"GET\",\n                        \"url\": M.cfg.wwwroot + \"/blocks/learnerscript/components/scheduler/ajax.php\",\n                        \"data\": {\n                            action: 'viewschusersdata',\n                            reportid: args.reportid,\n                            scheduleid: args.scheduleid,\n                            schuserslist: args.schuserslist\n                        }\n                    }\n                });\n            });\n        },\n        /**\n         * Add validation script to AJAX reponse MOODLE form\n         * @param  {object} args Form name and required classname\n         * @return {[type]}      [description]\n         */\n        schformvalidation: function(args) {\n            document.getElementById(args.form).addEventListener('submit', function(ev) {\n                try {\n                    var myValidator = report.validate_scheduled_reports_form(args);\n                } catch (e) {\n                    return true;\n                }\n                if (typeof window.tinyMCE !== 'undefined') {\n                    window.tinyMCE.triggerSave();\n                }\n                if (!myValidator) {\n                    ev.preventDefault();\n                }\n                return false;\n            });\n        },\n        /**\n         * Validates and return error message for each element of given form\n         * @param  {object} args Formname and required classname\n         * @return Returns list of error messages from validation\n         */\n        validate_scheduled_reports_form: function(args) {\n            var self = this;\n            var skipClientValidation = false;\n            if (skipClientValidation) {\n                $('.schreportform' + args.instanceid).dialog('destroy').remove();\n            }\n            var ret = true;\n            var first_focus = false;\n            $(\"[data-class='\" + args.reqclass + \"']\").each(function(index, value) {\n                var element = $(value).data('element');\n                ret = self.validate_scheduled_reports_form_element(value, element, args) && ret;\n                if (!ret && !first_focus) {\n                    first_focus = true;\n                    Y.use('moodle-core-event', function() {\n                        Y.Global.fire(M.core.globalEvents.FORM_ERROR, {\n                            formid: args.form,\n                            elementid: 'id_error_' + element + args.instanceid\n                        });\n                        document.getElementById('id_error_' + element + args.instanceid).focus();\n                    });\n                }\n            });\n            return ret;\n        },\n        /**\n         * Format error message string for each element\n         * @param  {object} element Element object\n         * @param  {string} escapedName Element name\n         * @param  {object} args Element object\n         * @return Formatted error messages for each element\n         */\n        validate_scheduled_reports_form_element: function(element, escapedName, args) {\n            if (undefined == element) {\n                return true;\n            }\n            var value = '';\n            var errFlag = new Array();\n            var _qfMsg = '';\n            var frm = element.parentNode;\n            if ((undefined != element.name) && (frm != undefined)) {\n                while (frm && frm.nodeName.toUpperCase() != 'FORM') {\n                    frm = frm.parentNode;\n                }\n                value = new Array();\n                var valueIdx = 0;\n                for (var i = 0; i < element.options.length; i++) {\n                    if (element.options[i].selected) {\n                        value[valueIdx++] = element.options[i].value;\n                    }\n                }\n                if (value == '' && !errFlag[escapedName]) {\n                    errFlag[escapedName] = true;\n                    Str.get_string('supplyvalue', 'block_learnerscript').then(function(s) {\n                        _qfMsg = _qfMsg + s;\n                    });\n                }\n                return this.qf_errorHandler(element, _qfMsg, escapedName, args);\n            } else {\n                return true;\n            }\n        },\n        /**\n         * Render and display error message for each element\n         * @param  {object} element  Element object\n         * @param  {string} _qfMsg  Error message\n         * @param  {string} escapedName Element name\n         * @param  {object} args  Element object\n         * @return Render and display error message for each element\n         */\n        qf_errorHandler: function(element, _qfMsg, escapedName, args) {\n            var event = $.Event(Event.Events.FORM_FIELD_VALIDATION);\n            $(element).trigger(event, _qfMsg);\n            if (event.isDefaultPrevented()) {\n                return _qfMsg == '';\n            } else {\n                // Legacy mforms.\n                var div = element.parentNode;\n                if ((div == undefined) || (element.name == undefined)) {\n                    // No checking can be done for undefined elements so let server handle it.\n                    return true;\n                }\n                if (_qfMsg != '') {\n                    var errorSpan = document.getElementById('id_error_' + escapedName + args.instanceid);\n                    if (!errorSpan) {\n                        errorSpan = document.createElement('span');\n                        errorSpan.id = 'id_error_' + escapedName + args.instanceid;\n                        errorSpan.className = 'error';\n                        element.parentNode.insertBefore(errorSpan, element.parentNode.firstChild);\n                        document.getElementById(errorSpan.id).setAttribute('TabIndex', '0');\n                        document.getElementById(errorSpan.id).focus();\n                    }\n                    while (errorSpan.firstChild) {\n                        errorSpan.removeChild(errorSpan.firstChild);\n                    }\n                    errorSpan.appendChild(document.createTextNode(_qfMsg.substring(3)));\n                    if (div.className.substr(div.className.length - 6, 6) != ' error' && div.className != 'error') {\n                        div.className += ' error';\n                        linebreak = document.createElement('br');\n                        linebreak.className = 'error';\n                        linebreak.id = 'id_error_break_' + escapedName + args.instanceid;\n                        errorSpan.parentNode.insertBefore(linebreak, errorSpan.nextSibling);\n                    }\n                    return false;\n                } else {\n                    var errorSpan = document.getElementById('id_error_' + escapedName + args.instanceid);\n                    if (errorSpan) {\n                        errorSpan.parentNode.removeChild(errorSpan);\n                    }\n                    var linebreak = document.getElementById('id_error_break_' + escapedName + args.instanceid);\n                    if (linebreak) {\n                        linebreak.parentNode.removeChild(linebreak);\n                    }\n                    if (div.className.substr(div.className.length - 6, 6) == ' error') {\n                        div.className = div.className.substr(0, div.className.length - 6);\n                    } else if (div.className == 'error') {\n                        div.className = '';\n                    }\n                    return true;\n                }\n            }\n        },\n        frequency_schedule: function(args) {\n            var promise = Ajax.call([{\n                methodname: 'block_learnerscript_frequency_schedule',\n                args: {\n                    frequency: $(\"#id_frequency\" + args.reportinstance).val()\n                }\n            }]);\n            promise[0].done(function(resp) {\n                resp = $.parseJSON(resp);\n                var template = '';\n                if (resp) {\n                    $.each(resp, function(index, value) {\n                        template += '<option value = ' + index + ' >' + value + '</option>';\n                    });\n                } else {\n                    Str.get_string('selectall', 'block_reportdashboard').then(function(s) {\n                        template += '<option value=null >' + s + '</option>';\n                    });\n                }\n                $(\"#id_updatefrequency\" + args.reportinstance).html(template);\n            }).fail(function() {\n                // do something with the exception\n                //  console.log(ex);\n            });\n        },\n        /**\n         * Manage more users to schedule report\n         * @param  {object} args reportid,scheduleid,selectedroleid and userslist\n         * @return Display popup with manage users for scheduled/Scheduling report\n         */\n        manageschusers: function(args) {\n            Str.get_strings([{\n                key:'scheduled_user',\n                component:'block_learnerscript'\n            },{\n                key:'close',\n                component:'block_learnerscript'\n            }]).then(function(s) {\n            var promise = Ajax.call([{\n                methodname: 'block_learnerscript_manageschusers',\n                args: {\n                    reportid: args.reportid,\n                    scheduleid: args.scheduleid,\n                    selectedroleid: JSON.stringify(args.selectedroleid),\n                    schuserslist: args.schuserslist,\n                    reportinstance: args.reportinstance\n                }\n            }]);\n\n            promise[0].done(function(response) {\n                response = $.parseJSON(response);\n                Templates.render('block_learnerscript/scheduledusers', response).done(function(html, js) {\n                    $('body').append(\"<div class='manageschusers'>\" + html, js + \"</div>\");\n                var bodyattb = $('body').attr('id');\n                var position, my, at;\n                if(bodyattb == 'page-blocks-learnerscript-components-scheduler-schedule'){\n                    position = '#scheduleform';\n                    my = \"center top\";\n                    at = \"center top\";\n                }else{\n                    position = window;\n                    my = \"center\";\n                    at = \"center\";\n                }\n                var dlg = $(\".manageschusers\").dialog({\n                    resizable: true,\n                    autoOpen: false,\n                    width: \"60%\",\n                    title: s[0],\n                    modal: true,\n                    position: {\n                        my: my,\n                        at: at,\n                        of: position,\n                        within: position\n                    },\n                    close: function() {\n                        $(this).dialog('destroy').remove();\n                    },\n                    open: function() {\n                        $(this).closest(\".ui-dialog\")\n                            .find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : s[1],\n                            });\n                    }\n                });\n                if($(\".manageschusers\").hasClass(\"notschuserspage\")){\n                    var parentdialog = $(\".manageschusers\").parent();\n                    parentdialog.addClass('notinschpage');\n                }\n                $(\".selectrole\" + args.reportid).select2();\n                dlg.dialog(\"open\");\n            });\n            }).fail(function() {\n                // do something with the exception\n                //  console.log(ex);\n            });\n\n        });\n        },\n        /**\n         * Get users for selected roles in bulk user form while searching\n         * @param  {object} args reportid and selected roles\n         * @return object List of users for selected roles\n         */\n        getroleusers: function(args) {\n            var roles = $('.selectrole' + args.reportid).val();\n            this.validate_scheduled_reports_form({\n                reportid: args.reportid,\n                form: 'assignform',\n                reqclass: 'rolereq'\n            });\n            var bullkselectedusers = $('.removeselect').val();\n            var template = '';\n            if ($('#addselect_searchtext').val().length < 1) {\n                Str.get_string('enter_value_insearch', 'block_learnerscript').then(function(s) {\n                    template = \"<optgroup label='\"+s+\"'></optgroup>\";\n                });\n                $('#' + args.type + 'select' + args.reportid).html(template);\n            } else {\n                var roleid = roles.split('_');\n                args.roleid = roleid[0];\n                args.contextlevel = roleid[1];\n                var promise = Ajax.call([{\n                    methodname: 'block_learnerscript_roleusers',\n                    args: {\n                        term: $('#addselect_searchtext').val(),\n                        type: args.type,\n                        reportid: args.reportid,\n                        roleid: args.roleid,\n                        contextlevel: args.contextlevel,\n                        scheduleid: args.scheduleid,\n                        bullkselectedusers: JSON.stringify(bullkselectedusers)\n                    },\n                }]);\n                promise[0].done(function(response) {\n                    var template = '';\n                    response = $.parseJSON(response);\n                    if (response.total_count > 0) {\n                        $.each(response.items, function(index, value) {\n                            template += '<option value = ' + value.id + ' >' + value.fullname + '</option>';\n                        });\n                    } else {\n                        Str.get_string('no_result', 'block_learnerscript').then(function(s) {\n                            template += \"<optgroup label='\"+s+\"'></optgroup>\";\n                        });\n                    }\n                    $('#' + args.type + 'select' + args.reportid).html(template);\n                }).fail(function() {\n                });\n            }\n        },\n        /**\n         * Add/remove bulk users to schedule reports\n         * @param  {object} args reportid\n         * @return Add/remove users to schedule report form\n         */\n        bulkmanageschusers: function(args) {\n            var bullkselectedusers = $.map($('.removeselect option'), function(e) {\n                return e.value;\n            });\n            $('#schuserslist' + args.reportinstance).val(bullkselectedusers);\n            var selectedusers = $('.removeselect').find('option').clone();\n            $('#id_users_data' + args.reportinstance).children('option').remove();\n            if (selectedusers.length > 10) {\n                Str.get_string('viewmore', 'block_learnerscript').then(function(s) {\n                    var tenusers = selectedusers.slice(0, 10);\n                    tenusers.attr('selected', 'selected').appendTo('#id_users_data' + args.reportinstance);\n                    var opt = document.createElement('option');\n                    opt.value = '-1';\n                    opt.innerHTML = s;\n                    opt.selected = true;\n                    document.getElementById('id_users_data' + args.reportinstance).appendChild(opt);\n\n                });\n            } else {\n                $('.removeselect').find('option').clone().attr('selected', 'selected').appendTo('#id_users_data' +\n                args.reportinstance);\n            }\n            $('.manageschusers').dialog('close');\n        },\n        /**\n         * Preview selected users to schedule report\n         * @param  {object} args reportid,scheduleid and userslist\n         * @return Preview users in dialog\n         */\n        viewschusers: function(args) {\n            Str.get_strings([{\n                key:'view_scheduled_users',\n                component:'block_learnerscript'\n            },{\n                key:'close',\n                component:'block_learnerscript'\n            }]).then(function(s){\n                args.schuserslist = $('#schuserslist' + args.reportinstance).val();\n                var promise = ajax.call({\n                    methodname: 'viewschuserstable',\n                    args: {\n                        action: 'viewschuserstable',\n                        reportid: args.reportid,\n                        scheduleid: args.scheduleid,\n                        schuserslist: args.schuserslist\n                    },\n                    url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\",\n                });\n                promise.done(function(response) {\n                    $('body').append(\"<div class='viewschuserstable'>\" + response + \"</div>\");\n\n                        var dlg = $(\".viewschuserstable\").dialog({\n                            resizable: true,\n                            autoOpen: false,\n                            width: \"60%\",\n                            title: s[0],\n                            modal: true,\n                            close: function() {\n                                $(this).dialog('destroy').remove();\n                            },\n                            open: function() {\n                                $(this).closest(\".ui-dialog\")\n                                    .find(\".ui-dialog-titlebar-close\")\n                                    .removeClass(\"ui-dialog-titlebar-close\")\n                                    .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                                    var Closebutton = $('.ui-icon-closethick').parent();\n                                    $(Closebutton).attr({\n                                        \"title\" : s[1]\n                                    });\n                            }\n                        });\n                        schedule.ViewSchUsersTable(args);\n                        dlg.dialog(\"open\").prev(\".ui-dialog-titlebar\").css(\"color\", \"#0C75B6\");\n                    }).fail(function() {\n                    });\n            });\n        },\n        /**\n         * Add users to schedule report\n         * @param  {object} args reportid\n         * @return Adds users to schedule report form\n         */\n        addschusers: function(args) {\n            var selschusers = $('.schforms' + args.reportinstance + ' #id_users_data' + args.reportinstance).val();\n            var selusers = $('.schforms' + args.reportinstance + ' #schuserslist' + args.reportinstance).val();\n            var total;\n            if (selusers) {\n                selusers = selusers.split(',');\n                total = selusers.concat(selschusers);\n            } else {\n                total = selschusers;\n            }\n            if (total && total.includes('-1')) {\n                var index = total.indexOf('-1');\n                total.splice(index, 1);\n            }\n            $('#id_users_data' + args.reportinstance).find('option').not(':selected').each(function(k, v) {\n                if (total && total.includes(v.value)) {\n                    var index = total.indexOf(v.value);\n                    total.splice(index, 1);\n                }\n            });\n            var d = total && total.filter(function(item, pos) {\n                return total.indexOf(item) == pos;\n            });\n            $('#schuserslist' + args.reportinstance).val(d);\n        },\n        /**\n         * Get roleusers for selected report\n         */\n        SelectRoleUsers: function() {\n            var reportid = $(\".schform\").data('reportid');\n            require(['block_learnerscript/helper'], function(helper) {\n                helper.Select2Ajax({\n                    reportid: reportid,\n                    action: 'rolewiseusers',\n                    maximumselectionlength: 5\n                });\n            });\n        },\n        rolewiseusers: function(args) {\n            $('#id_users_data' + args.reportinstance).val(null).trigger('change');\n        },\n    };\n    return schedule;\n});\n"],"names":["define","$","Ajax","ajax","Event","select2","report","Str","Templates","schedule","schreportform","args","call","methodname","reportid","instance","instanceid","done","response","parseJSON","append","title_img","M","util","image_url","get_strings","key","component","then","s","dialog","resizable","autoOpen","width","title","modal","appendTo","position","my","at","of","open","this","closest","find","removeClass","html","Closebutton","parent","attr","close","remove","SelectRoleUsers","schformvalidation","form","reqclass","fail","ScheduledTimings","theme","dataTable","processing","serverSide","lengthMenu","idisplaylength","ordering","method","url","cfg","wwwroot","data","document","on","reportinstance","rolewiseusers","addschusers","frequency_schedule","ViewSchUsersTable","action","scheduleid","schuserslist","getElementById","addEventListener","ev","myValidator","validate_scheduled_reports_form","e","window","tinyMCE","triggerSave","preventDefault","self","ret","first_focus","each","index","value","element","validate_scheduled_reports_form_element","Y","use","Global","fire","core","globalEvents","FORM_ERROR","formid","elementid","focus","escapedName","undefined","errFlag","Array","_qfMsg","frm","parentNode","name","nodeName","toUpperCase","valueIdx","i","options","length","selected","get_string","qf_errorHandler","event","Events","FORM_FIELD_VALIDATION","trigger","isDefaultPrevented","div","errorSpan","createElement","id","className","insertBefore","firstChild","setAttribute","removeChild","appendChild","createTextNode","substring","substr","linebreak","nextSibling","frequency","val","resp","template","manageschusers","selectedroleid","JSON","stringify","render","js","dlg","within","hasClass","addClass","getroleusers","roles","bullkselectedusers","type","roleid","split","contextlevel","term","total_count","items","fullname","bulkmanageschusers","map","selectedusers","clone","children","slice","opt","innerHTML","viewschusers","prev","css","total","selschusers","selusers","concat","includes","indexOf","splice","not","k","v","d","filter","item","pos","require","helper","Select2Ajax","maximumselectionlength"],"mappings":";;;;;;;AAsBAA,sCAAO,CAAC,SACJ,YACA,2BACA,aACA,sCACA,6BACA,WACA,mBACD,SAASC,EAAGC,KAAMC,KAAMC,MAAOC,QAASC,OAAQC,IAAKC,WAEpD,IAAIC,SAAW,CASXC,cAAe,SAASC,MACNT,KAAKU,KAAK,CAAC,CACrBC,WAAY,oCACZF,KAAM,CACFG,SAAUH,KAAKG,SACfC,SAAUJ,KAAKK,eAGf,GAAGC,MAAK,SAASC,UACrBA,SAAWjB,EAAEkB,UAAUD,UACvBjB,EAAE,QAAQmB,OAAO,4BAA8BT,KAAKK,WAAa,KAAOE,SAAW,UACnF,IAAIG,UAAY,8DACZC,EAAEC,KAAKC,UAAU,gBAAiB,uBAAyB,MAC/DjB,IAAIkB,YAAY,CAAC,CACbC,IAAK,uBACLC,UAAU,uBACZ,CACED,IAAK,QACLC,UAAU,uBACZ,CACED,IAAK,kBACLC,UAAU,yBACVC,MAAK,SAASC,GACJ5B,EAAE,iBAAmBU,KAAKK,YAAYc,OAAO,CACnDC,WAAW,EACXC,UAAU,EACVC,MAAO,MACPC,MAAML,EAAE,GACRM,OAAO,EACPC,SAAU,QAAUzB,KAAKK,WACzBqB,SAAU,CACNC,GAAI,SACJC,GAAI,SACJC,GAAI,mBAAqB7B,KAAKK,YAElCyB,KAAM,WACFxC,EAAEyC,MAAMC,QAAQ,cAAcC,KAAK,6BAC9BC,YAAY,4BACZC,KAAK,2EACN,IAAIC,YAAc9C,EAAE,uBAAuB+C,SAC3C/C,EAAE8C,aAAaE,KAAK,CAChBf,MAAUL,EAAE,KAEpB5B,EAAEyC,MAAMC,QAAQ,cAAcC,KAAK,oBAC9BE,KAAKzB,UAAY,oBAE1B6B,MAAO,WACHjD,EAAEyC,MAAMZ,OAAO,WAAWqB,YAGxBlD,EAAE,iBAAmBU,KAAKK,YAAYc,OAAO,CACnDC,WAAW,EACXC,UAAU,EACVC,MAAO,MACPC,MAAOL,EAAE,GACTM,OAAO,EACPC,SAAU,QAAUzB,KAAKK,WACzBqB,SAAU,CACNC,GAAI,SACJC,GAAI,SACJC,GAAI,mBAAqB7B,KAAKK,YAElCyB,KAAM,WACFxC,EAAEyC,MAAMC,QAAQ,cAAcC,KAAK,6BAC9BC,YAAY,4BACZC,KAAK,2EACN,IAAIC,YAAc9C,EAAE,uBAAuB+C,SAC3C/C,EAAE8C,aAAaE,KAAK,CAChBf,MAAUL,EAAE,KAEpB5B,EAAEyC,MAAMC,QAAQ,cAAcC,KAAK,oBAC9BE,KAAKzB,UAAYQ,EAAE,KAE5BqB,MAAO,WACHjD,EAAEyC,MAAMZ,OAAO,WAAWqB,YAG9BrB,OAAO,WAGf7B,EAAE,WAAaU,KAAKK,YAAYX,UAChCqC,KAAKU,kBACLV,KAAKW,kBAAkB,CACnBvC,SAAUH,KAAKG,SACfwC,KAAM,UAAY3C,KAAKK,WACvBuC,SAAU,aAAe5C,KAAKK,WAC9BA,WAAYL,KAAKK,gBAEtBwC,MAAK,gBAGZC,iBAAkB,SAAS9C,MACvBV,EAAE,4BAA4BI,QAAQ,CAClCqD,MAAO,YAEXhB,KAAKU,kBACL7C,IAAIkB,YAAY,CAAC,CACbC,IAAK,aACLC,UAAW,yBACXC,MAAK,SAASC,GACd5B,EAAE,qBAAqB0D,UAAU,CAC7BC,YAAc,EACdC,YAAc,EACdC,WAAc,CACV,CAAC,EAAG,GAAI,GAAI,IAAK,GACjB,CAAC,EAAG,GAAI,GAAI,GAAIjC,EAAE,KAEtBkC,eAAkB,EAClBC,UAAY,EACZ7D,KAAQ,CACJ8D,OAAU,MACVC,IAAO5C,EAAE6C,IAAIC,QAAU,sDACvBC,KAAQ1D,WAQpBV,EAAEqE,UAAUC,GAAG,SAAU,qBAAqB,WAC1C,IAAIzD,SAAWb,EAAEyC,MAAM2B,KAAK,YACxBG,eAAiBvE,EAAEyC,MAAM2B,KAAK,kBAClC5D,SAASgE,cAAc,CAAC3D,SAAUA,SAAU0D,eAAgBA,oBAOhEvE,EAAEqE,UAAUC,GAAG,SAAU,kBAAkB,WACvC,IAAIzD,SAAWb,EAAEyC,MAAM2B,KAAK,YACxBG,eAAiBvE,EAAEyC,MAAM2B,KAAK,kBAClC5D,SAASiE,YAAY,CAAC5D,SAAUA,SAAU0D,eAAgBA,oBAG9DvE,EAAEqE,UAAUC,GAAG,SAAU,4BAA4B,WACjD,IAAIzD,SAAWb,EAAEyC,MAAM2B,KAAK,YACxBG,eAAiBvE,EAAEyC,MAAM2B,KAAK,kBAClC5D,SAASkE,mBAAmB,CAAC7D,SAAUA,SAAU0D,eAAgBA,qBAIzEI,kBAAmB,SAASjE,MACxBJ,IAAIkB,YAAY,CAAC,CACbC,IAAK,aACLC,UAAW,yBACXC,MAAK,SAASC,GACd5B,EAAE,mBAAmB0D,UAAU,CAC3BC,YAAc,EACdC,YAAc,EACdC,WAAc,CACV,CAAC,EAAG,GAAI,GAAI,IAAK,GACjB,CAAC,EAAG,GAAI,GAAI,GAAIjC,EAAE,KAEtBkC,eAAkB,EAClBC,UAAY,EACZ7D,KAAQ,CACJ8D,OAAU,MACVC,IAAO5C,EAAE6C,IAAIC,QAAU,sDACvBC,KAAQ,CACJQ,OAAQ,mBACR/D,SAAUH,KAAKG,SACfgE,WAAYnE,KAAKmE,WACjBC,aAAcpE,KAAKoE,qBAWvC1B,kBAAmB,SAAS1C,MACxB2D,SAASU,eAAerE,KAAK2C,MAAM2B,iBAAiB,UAAU,SAASC,IACnE,IACI,IAAIC,YAAc7E,OAAO8E,gCAAgCzE,MAC3D,MAAO0E,GACL,OAAO,EAQX,YAN8B,IAAnBC,OAAOC,SACdD,OAAOC,QAAQC,cAEdL,aACDD,GAAGO,kBAEA,MAQfL,gCAAiC,SAASzE,MACtC,IAAI+E,KAAOhD,KAKX,IAAIiD,KAAM,EACNC,aAAc,EAelB,OAdA3F,EAAE,gBAAkBU,KAAK4C,SAAW,MAAMsC,MAAK,SAASC,MAAOC,OAC3D,IAAIC,QAAU/F,EAAE8F,OAAO1B,KAAK,YAC5BsB,IAAMD,KAAKO,wCAAwCF,MAAOC,QAASrF,OAASgF,MAC/DC,cACTA,aAAc,EACdM,EAAEC,IAAI,qBAAqB,WACvBD,EAAEE,OAAOC,KAAK/E,EAAEgF,KAAKC,aAAaC,WAAY,CAC1CC,OAAQ9F,KAAK2C,KACboD,UAAW,YAAcV,QAAUrF,KAAKK,aAE5CsD,SAASU,eAAe,YAAcgB,QAAUrF,KAAKK,YAAY2F,eAItEhB,KASXM,wCAAyC,SAASD,QAASY,YAAajG,MACpE,GAAIkG,MAAab,QACb,OAAO,EAEX,IAAID,MAAQ,GACRe,QAAU,IAAIC,MACdC,OAAS,GACTC,IAAMjB,QAAQkB,WAClB,GAAKL,MAAab,QAAQmB,MAAiBN,MAAPI,IAAmB,CACnD,KAAOA,KAAqC,QAA9BA,IAAIG,SAASC,eACvBJ,IAAMA,IAAIC,WAEdnB,MAAQ,IAAIgB,MAEZ,IADA,IAAIO,SAAW,EACNC,EAAI,EAAGA,EAAIvB,QAAQwB,QAAQC,OAAQF,IACpCvB,QAAQwB,QAAQD,GAAGG,WACnB3B,MAAMuB,YAActB,QAAQwB,QAAQD,GAAGxB,OAS/C,MANa,IAATA,OAAgBe,QAAQF,eACxBE,QAAQF,cAAe,EACvBrG,IAAIoH,WAAW,cAAe,uBAAuB/F,MAAK,SAASC,GAC/DmF,QAAkBnF,MAGnBa,KAAKkF,gBAAgB5B,QAASgB,OAAQJ,YAAajG,MAE1D,OAAO,GAWfiH,gBAAiB,SAAS5B,QAASgB,OAAQJ,YAAajG,MACpD,IAAIkH,MAAQ5H,EAAEG,MAAMA,MAAM0H,OAAOC,uBAEjC,GADA9H,EAAE+F,SAASgC,QAAQH,MAAOb,QACtBa,MAAMI,qBACN,MAAiB,IAAVjB,OAGP,IAAIkB,IAAMlC,QAAQkB,WAClB,GAAYL,MAAPqB,KAAsCrB,MAAhBb,QAAQmB,KAE/B,OAAO,EAEX,GAAc,IAAVH,OAAc,CACd,IAAImB,UASJ,KATIA,UAAY7D,SAASU,eAAe,YAAc4B,YAAcjG,KAAKK,gBAErEmH,UAAY7D,SAAS8D,cAAc,SACzBC,GAAK,YAAczB,YAAcjG,KAAKK,WAChDmH,UAAUG,UAAY,QACtBtC,QAAQkB,WAAWqB,aAAaJ,UAAWnC,QAAQkB,WAAWsB,YAC9DlE,SAASU,eAAemD,UAAUE,IAAII,aAAa,WAAY,KAC/DnE,SAASU,eAAemD,UAAUE,IAAI1B,SAEnCwB,UAAUK,YACbL,UAAUO,YAAYP,UAAUK,YAUpC,OARAL,UAAUQ,YAAYrE,SAASsE,eAAe5B,OAAO6B,UAAU,KACN,UAArDX,IAAII,UAAUQ,OAAOZ,IAAII,UAAUb,OAAS,EAAG,IAAmC,SAAjBS,IAAII,YACrEJ,IAAII,WAAa,UACjBS,UAAYzE,SAAS8D,cAAc,OACzBE,UAAY,QACtBS,UAAUV,GAAK,kBAAoBzB,YAAcjG,KAAKK,WACtDmH,UAAUjB,WAAWqB,aAAaQ,UAAWZ,UAAUa,eAEpD,GAEHb,UAAY7D,SAASU,eAAe,YAAc4B,YAAcjG,KAAKK,cAErEmH,UAAUjB,WAAWwB,YAAYP,WAErC,IAAIY,UAAYzE,SAASU,eAAe,kBAAoB4B,YAAcjG,KAAKK,YAS/E,OARI+H,WACAA,UAAU7B,WAAWwB,YAAYK,WAEoB,UAArDb,IAAII,UAAUQ,OAAOZ,IAAII,UAAUb,OAAS,EAAG,GAC/CS,IAAII,UAAYJ,IAAII,UAAUQ,OAAO,EAAGZ,IAAII,UAAUb,OAAS,GACvC,SAAjBS,IAAII,YACXJ,IAAII,UAAY,KAEb,GAInB3D,mBAAoB,SAAShE,MACXT,KAAKU,KAAK,CAAC,CACrBC,WAAY,yCACZF,KAAM,CACFsI,UAAWhJ,EAAE,gBAAkBU,KAAK6D,gBAAgB0E,UAGpD,GAAGjI,MAAK,SAASkI,MACrBA,KAAOlJ,EAAEkB,UAAUgI,MACnB,IAAIC,SAAW,GACXD,KACAlJ,EAAE4F,KAAKsD,MAAM,SAASrD,MAAOC,OACzBqD,UAAY,mBAAqBtD,MAAQ,KAAOC,MAAQ,eAG5DxF,IAAIoH,WAAW,YAAa,yBAAyB/F,MAAK,SAASC,GAC/DuH,UAAY,uBAAyBvH,EAAI,eAGjD5B,EAAE,sBAAwBU,KAAK6D,gBAAgB1B,KAAKsG,aACrD5F,MAAK,gBAUZ6F,eAAgB,SAAS1I,MACrBJ,IAAIkB,YAAY,CAAC,CACbC,IAAI,iBACJC,UAAU,uBACZ,CACED,IAAI,QACJC,UAAU,yBACVC,MAAK,SAASC,GACJ3B,KAAKU,KAAK,CAAC,CACrBC,WAAY,qCACZF,KAAM,CACFG,SAAUH,KAAKG,SACfgE,WAAYnE,KAAKmE,WACjBwE,eAAgBC,KAAKC,UAAU7I,KAAK2I,gBACpCvE,aAAcpE,KAAKoE,aACnBP,eAAgB7D,KAAK6D,mBAIrB,GAAGvD,MAAK,SAASC,UACrBA,SAAWjB,EAAEkB,UAAUD,UACvBV,UAAUiJ,OAAO,qCAAsCvI,UAAUD,MAAK,SAAS6B,KAAM4G,IAErF,IACIrH,SAAUC,GAAIC,GAFdtC,EAAE,QAAQmB,OAAO,+BAAiC0B,KAAM4G,GAAK,UAGlD,2DAFAzJ,EAAE,QAAQgD,KAAK,OAG1BZ,SAAW,gBACXC,GAAK,aACLC,GAAK,eAELF,SAAWiD,OACXhD,GAAK,SACLC,GAAK,UAET,IAAIoH,IAAM1J,EAAE,mBAAmB6B,OAAO,CAClCC,WAAW,EACXC,UAAU,EACVC,MAAO,MACPC,MAAOL,EAAE,GACTM,OAAO,EACPE,SAAU,CACNC,GAAIA,GACJC,GAAIA,GACJC,GAAIH,SACJuH,OAAQvH,UAEZa,MAAO,WACHjD,EAAEyC,MAAMZ,OAAO,WAAWqB,UAE9BV,KAAM,WACFxC,EAAEyC,MAAMC,QAAQ,cACXC,KAAK,6BACLC,YAAY,4BACZC,KAAK,2EACN,IAAIC,YAAc9C,EAAE,uBAAuB+C,SAC3C/C,EAAE8C,aAAaE,KAAK,CAChBf,MAAUL,EAAE,QAIzB5B,EAAE,mBAAmB4J,SAAS,oBACV5J,EAAE,mBAAmB+C,SAC3B8G,SAAS,gBAE1B7J,EAAE,cAAgBU,KAAKG,UAAUT,UACjCsJ,IAAI7H,OAAO,cAEZ0B,MAAK,mBAYZuG,aAAc,SAASpJ,MACnB,IAAIqJ,MAAQ/J,EAAE,cAAgBU,KAAKG,UAAUoI,MAC7CxG,KAAK0C,gCAAgC,CACjCtE,SAAUH,KAAKG,SACfwC,KAAM,aACNC,SAAU,YAEd,IAAI0G,mBAAqBhK,EAAE,iBAAiBiJ,MACxCE,SAAW,GACf,GAAInJ,EAAE,yBAAyBiJ,MAAMzB,OAAS,EAC1ClH,IAAIoH,WAAW,uBAAwB,uBAAuB/F,MAAK,SAASC,GACxEuH,SAAW,oBAAoBvH,EAAE,mBAErC5B,EAAE,IAAMU,KAAKuJ,KAAO,SAAWvJ,KAAKG,UAAUgC,KAAKsG,cAChD,CACH,IAAIe,OAASH,MAAMI,MAAM,KACzBzJ,KAAKwJ,OAASA,OAAO,GACrBxJ,KAAK0J,aAAeF,OAAO,GACbjK,KAAKU,KAAK,CAAC,CACrBC,WAAY,gCACZF,KAAM,CACF2J,KAAMrK,EAAE,yBAAyBiJ,MACjCgB,KAAMvJ,KAAKuJ,KACXpJ,SAAUH,KAAKG,SACfqJ,OAAQxJ,KAAKwJ,OACbE,aAAc1J,KAAK0J,aACnBvF,WAAYnE,KAAKmE,WACjBmF,mBAAoBV,KAAKC,UAAUS,wBAGnC,GAAGhJ,MAAK,SAASC,UACrB,IAAIkI,SAAW,IACflI,SAAWjB,EAAEkB,UAAUD,WACVqJ,YAAc,EACvBtK,EAAE4F,KAAK3E,SAASsJ,OAAO,SAAS1E,MAAOC,OACnCqD,UAAY,mBAAqBrD,MAAMsC,GAAK,KAAOtC,MAAM0E,SAAW,eAGxElK,IAAIoH,WAAW,YAAa,uBAAuB/F,MAAK,SAASC,GAC7DuH,UAAY,oBAAoBvH,EAAE,mBAG1C5B,EAAE,IAAMU,KAAKuJ,KAAO,SAAWvJ,KAAKG,UAAUgC,KAAKsG,aACpD5F,MAAK,iBAShBkH,mBAAoB,SAAS/J,MACzB,IAAIsJ,mBAAqBhK,EAAE0K,IAAI1K,EAAE,yBAAyB,SAASoF,GAC/D,OAAOA,EAAEU,SAEb9F,EAAE,gBAAkBU,KAAK6D,gBAAgB0E,IAAIe,oBAC7C,IAAIW,cAAgB3K,EAAE,iBAAiB2C,KAAK,UAAUiI,QACtD5K,EAAE,iBAAmBU,KAAK6D,gBAAgBsG,SAAS,UAAU3H,SACzDyH,cAAcnD,OAAS,GACvBlH,IAAIoH,WAAW,WAAY,uBAAuB/F,MAAK,SAASC,GAC7C+I,cAAcG,MAAM,EAAG,IAC7B9H,KAAK,WAAY,YAAYb,SAAS,iBAAmBzB,KAAK6D,gBACvE,IAAIwG,IAAM1G,SAAS8D,cAAc,UACjC4C,IAAIjF,MAAQ,KACZiF,IAAIC,UAAYpJ,EAChBmJ,IAAItD,UAAW,EACfpD,SAASU,eAAe,gBAAkBrE,KAAK6D,gBAAgBmE,YAAYqC,QAI/E/K,EAAE,iBAAiB2C,KAAK,UAAUiI,QAAQ5H,KAAK,WAAY,YAAYb,SAAS,iBAChFzB,KAAK6D,gBAETvE,EAAE,mBAAmB6B,OAAO,UAOhCoJ,aAAc,SAASvK,MACnBJ,IAAIkB,YAAY,CAAC,CACbC,IAAI,uBACJC,UAAU,uBACZ,CACED,IAAI,QACJC,UAAU,yBACVC,MAAK,SAASC,GACdlB,KAAKoE,aAAe9E,EAAE,gBAAkBU,KAAK6D,gBAAgB0E,MAC/C/I,KAAKS,KAAK,CACpBC,WAAY,oBACZF,KAAM,CACFkE,OAAQ,oBACR/D,SAAUH,KAAKG,SACfgE,WAAYnE,KAAKmE,WACjBC,aAAcpE,KAAKoE,cAEvBb,IAAK5C,EAAE6C,IAAIC,QAAU,mCAEjBnD,MAAK,SAASC,UAClBjB,EAAE,QAAQmB,OAAO,kCAAoCF,SAAW,UAE5D,IAAIyI,IAAM1J,EAAE,sBAAsB6B,OAAO,CACrCC,WAAW,EACXC,UAAU,EACVC,MAAO,MACPC,MAAOL,EAAE,GACTM,OAAO,EACPe,MAAO,WACHjD,EAAEyC,MAAMZ,OAAO,WAAWqB,UAE9BV,KAAM,WACFxC,EAAEyC,MAAMC,QAAQ,cACXC,KAAK,6BACLC,YAAY,4BACZC,KAAK,2EACN,IAAIC,YAAc9C,EAAE,uBAAuB+C,SAC3C/C,EAAE8C,aAAaE,KAAK,CAChBf,MAAUL,EAAE,QAI5BpB,SAASmE,kBAAkBjE,MAC3BgJ,IAAI7H,OAAO,QAAQqJ,KAAK,uBAAuBC,IAAI,QAAS,cAC7D5H,MAAK,mBASpBkB,YAAa,SAAS/D,MAClB,IAEI0K,MAFAC,YAAcrL,EAAE,YAAcU,KAAK6D,eAAiB,kBAAoB7D,KAAK6D,gBAAgB0E,MAC7FqC,SAAWtL,EAAE,YAAcU,KAAK6D,eAAiB,iBAAmB7D,KAAK6D,gBAAgB0E,MAQ7F,GANIqC,UACAA,SAAWA,SAASnB,MAAM,KAC1BiB,MAAQE,SAASC,OAAOF,cAExBD,MAAQC,YAERD,OAASA,MAAMI,SAAS,MAAO,CAC/B,IAAI3F,MAAQuF,MAAMK,QAAQ,MAC1BL,MAAMM,OAAO7F,MAAO,GAExB7F,EAAE,iBAAmBU,KAAK6D,gBAAgB5B,KAAK,UAAUgJ,IAAI,aAAa/F,MAAK,SAASgG,EAAGC,GACvF,GAAIT,OAASA,MAAMI,SAASK,EAAE/F,OAAQ,CAClC,IAAID,MAAQuF,MAAMK,QAAQI,EAAE/F,OAC5BsF,MAAMM,OAAO7F,MAAO,OAG5B,IAAIiG,EAAIV,OAASA,MAAMW,QAAO,SAASC,KAAMC,KACzC,OAAOb,MAAMK,QAAQO,OAASC,OAElCjM,EAAE,gBAAkBU,KAAK6D,gBAAgB0E,IAAI6C,IAKjD3I,gBAAiB,WACb,IAAItC,SAAWb,EAAE,YAAYoE,KAAK,YAClC8H,QAAQ,CAAC,+BAA+B,SAASC,QAC7CA,OAAOC,YAAY,CACfvL,SAAUA,SACV+D,OAAQ,gBACRyH,uBAAwB,QAIpC7H,cAAe,SAAS9D,MACpBV,EAAE,iBAAmBU,KAAK6D,gBAAgB0E,IAAI,MAAMlB,QAAQ,YAGpE,OAAOvH,QACX"}